<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Swarnim Collection</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Lato', 'Segoe UI', sans-serif; background: #f0f2f5; padding: 40px 20px; color: #333; }
        .card { 
            background: white; max-width: 750px; margin: 0 auto; padding: 40px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-radius: 12px; 
        }
        
        /* Tab System */
        .tab-container {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
        }
        .tab-btn {
            background: transparent;
            border: none;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            color: #666;
            transition: all 0.3s;
        }
        .tab-btn:hover {
            color: #333;
            background: #fafafa;
        }
        .tab-btn.active {
            color: #d4af37;
            border-bottom-color: #d4af37;
            background: white;
        }
        
        .tab-panel {
            display: none;
        }
        .tab-panel.active {
            display: block;
        }
        
        h2 { text-align: center; margin-bottom: 30px; color: #1a1a1a; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; }
        
        input, textarea, select { 
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; 
            box-sizing: border-box; font-size: 1rem; transition: border 0.2s; background: white;
        }
        input:focus, textarea:focus, select:focus { border-color: #d4af37; outline: none; }
        textarea { height: 100px; resize: vertical; }
        
        .file-box { background: #fafafa; border: 2px dashed #ddd; padding: 20px; border-radius: 6px; text-align: center; margin-bottom: 20px; cursor: pointer; }
        .file-box:hover { border-color: #d4af37; background: #f5f5f5; }
        
        button { 
            width: 100%; padding: 15px; background: #000; color: #fff; cursor: pointer; 
            border: none; font-weight: bold; border-radius: 6px; font-size: 1rem; transition: 0.3s;
        }
        button:hover { background: #333; }
        button:disabled { background: #999; cursor: not-allowed; }
        
        .preview { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
        .preview img { width: 80px; height: 80px; object-fit: cover; border-radius: 4px; border: 1px solid #eee; }
        
        #status { text-align: center; margin-top: 20px; font-weight: bold; }
        .auto-id { background: #e9ecef; color: #666; cursor: not-allowed; }

        /* â•â•â• VIDEO SECTION STYLES â•â•â• */
        .video-section {
            background: #f8f9fa;
            border: 2px dashed #d4af37;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .video-info-box {
            background: #fffbf0;
            border-left: 4px solid #d4af37;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .video-info-box h4 {
            color: #d4af37;
            margin-bottom: 10px;
        }
        
        .video-info-box ul {
            margin-left: 20px;
            color: #666;
        }
        
        .video-count-badge {
            display: inline-block;
            background: #d4af37;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin-left: 8px;
        }
        
        .video-list {
            margin: 15px 0;
        }
        
        .video-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .video-thumbnail {
            width: 80px;
            height: 80px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .video-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-info {
            flex: 1;
        }
        
        .video-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        
        .video-size {
            color: #666;
            font-size: 0.85rem;
        }
        
        .video-actions button {
            padding: 6px 12px;
            font-size: 0.85rem;
            background: #dc3545;
            width: auto;
        }
        
        .video-actions button:hover {
            background: #c82333;
        }
        
        .upload-video-btn {
            background: #d4af37 !important;
            width: 100%;
            margin-top: 10px;
        }
        
        .upload-video-btn:hover {
            background: #c49437 !important;
        }
        
        .upload-video-btn:disabled {
            background: #999 !important;
        }
        
        .video-progress {
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
            display: none;
        }
        
        .video-progress-bar {
            height: 100%;
            background: #d4af37;
            width: 0%;
            transition: width 0.3s;
        }
        
        .video-upload-status {
            text-align: center;
            font-size: 0.9rem;
            margin-top: 10px;
            display: none;
        }
        
        /* BANNER SECTION */
        .banner-specs {
            background: #fffbf0;
            border-left: 4px solid #d4af37;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .banner-specs h4 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .banner-specs ul {
            margin-left: 20px;
            color: #666;
            font-size: 14px;
        }
        
        .banner-list {
            margin-top: 30px;
        }
        
        .banner-item {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: #f9f9f9;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .banner-item img {
            width: 120px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .banner-item .banner-info {
            flex: 1;
        }
        
        .banner-item button {
            padding: 8px 15px;
            margin: 0 5px;
            width: auto;
        }
        
        /* CATEGORY SECTION */
        .category-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .category-input-group input {
            flex: 1;
        }
        
        .category-input-group button {
            width: auto;
            padding: 12px 30px;
            background: #d4af37;
        }
        
        .category-input-group button:hover {
            background: #c49437;
        }
        
        .category-list {
            margin-top: 20px;
        }
        
        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f9f9f9;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        
        .category-item button {
            background: white;
            border: 1px solid #ddd;
            color: #d35400;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            width: auto;
        }
        
        .category-item button:hover {
            background: #fee;
            border-color: #d35400;
        }
    </style>
</head>
<body>
    <div class="card">
        <!-- Tab Navigation -->
        <div class="tab-container">
            <button class="tab-btn active" onclick="switchTab(0)">ðŸ“¦ Add Product</button>
            <button class="tab-btn" onclick="switchTab(1)">ðŸ·ï¸ Manage Categories</button>
            <button class="tab-btn" onclick="switchTab(2)">ðŸŽ¨ Manage Banners</button>
        </div>

        <!-- ADD PRODUCT TAB -->
        <div class="tab-panel active">
            <h2>Add New Product</h2>
            
            <form id="productForm">
                <div class="form-group">
                    <label>Product ID (Auto-Generated)</label>
                    <input type="text" id="productId" class="auto-id" readonly>
                </div>

                <div class="form-group">
                    <label>Category</label>
                    <select id="category" required>
                        <option value="">Select a category...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Product Name</label>
                    <input type="text" id="productName" placeholder="e.g. Ruby AD Necklace" required>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea id="description" placeholder="Product details..."></textarea>
                </div>

                <div class="form-group">
                    <label>Price (â‚¹)</label>
                    <input type="number" id="price" placeholder="2500" required>
                </div>

                <div class="form-group">
                    <label>Cover Image (Required)</label>
                    <div class="file-box" onclick="document.getElementById('coverImage').click()">
                        <input type="file" id="coverImage" accept="image/*" style="display: none;" onchange="handleCoverImage(this)">
                        <p>ðŸ“¸ Click to upload cover image</p>
                    </div>
                    <div class="preview" id="coverPreview"></div>
                </div>

                <div class="form-group">
                    <label>Gallery Images (Optional, Multiple)</label>
                    <div class="file-box" onclick="document.getElementById('galleryImages').click()">
                        <input type="file" id="galleryImages" accept="image/*" multiple style="display: none;" onchange="handleGalleryImages(this)">
                        <p>ðŸ–¼ï¸ Click to upload multiple images</p>
                    </div>
                    <div class="preview" id="galleryPreview"></div>
                </div>

                <!-- VIDEO SECTION -->
                <div class="video-section">
                    <h3 style="margin-bottom: 15px;">ðŸ“¹ Product Videos (Optional)</h3>
                    
                    <div class="video-info-box">
                        <h4>ðŸ’¡ Video Tips:</h4>
                        <ul>
                            <li>Max 32MB per video (compress to 10-20MB recommended)</li>
                            <li>MP4 format, 720p resolution</li>
                            <li>Keep videos short (30-60 seconds)</li>
                            <li>Use Handbrake to compress before uploading</li>
                        </ul>
                    </div>

                    <div style="text-align: center; padding: 15px; background: white; border-radius: 6px; margin-bottom: 15px;">
                        <p style="color: #666;">Current Videos: <span class="video-count-badge" id="videoCount">0</span></p>
                    </div>

                    <div class="video-list" id="videoList"></div>

                    <div class="file-box" onclick="document.getElementById('videoFileInput').click()">
                        <input type="file" id="videoFileInput" accept="video/*" style="display: none;">
                        <p>ðŸ“¹ Click to select video</p>
                    </div>
                    
                    <div class="video-progress" id="videoProgress">
                        <div class="video-progress-bar" id="videoProgressBar"></div>
                    </div>
                    <div class="video-upload-status" id="videoUploadStatus"></div>
                    
                    <button type="button" class="upload-video-btn" id="uploadVideoBtn" disabled>
                        âž• Upload Video to Cloudflare R2
                    </button>
                </div>

                <button type="submit">Upload & Save Product</button>
                <div id="status"></div>
            </form>
        </div>

        <!-- MANAGE CATEGORIES TAB -->
        <div class="tab-panel">
            <h2>Manage Categories</h2>

            <div class="category-input-group">
                <input type="text" id="newCategoryName" placeholder="Enter new category name...">
                <button onclick="addCategory()">+ Add</button>
            </div>

            <div class="category-list" id="categoryList"></div>
        </div>

        <!-- MANAGE BANNERS TAB -->
        <div class="tab-panel">
            <h2>Manage Homepage Banners</h2>

            <div class="banner-specs">
                <h4>ðŸŽ¨ Banner Image Specifications:</h4>
                <ul>
                    <li>Dimensions: <strong>1920 x 800 pixels</strong> (Width x Height)</li>
                    <li>Format: JPG or PNG</li>
                    <li>Max File Size: 500KB (recommended)</li>
                    <li>Keep important content in center 60% of image</li>
                </ul>
            </div>

            <h3 style="margin-bottom: 15px;">Upload New Banner</h3>
            <div class="file-box" onclick="document.getElementById('bannerImage').click()">
                <input type="file" id="bannerImage" accept="image/*" style="display: none;">
                <p>ðŸ–¼ï¸ Click to select banner image</p>
            </div>
            <button onclick="uploadBanner()" id="uploadBannerBtn" disabled>Upload Banner</button>

            <h3 style="margin: 30px 0 15px 0;">Active Banners</h3>
            <div class="banner-list" id="bannerList"></div>
        </div>
    </div>

    <!-- AWS SDK for Cloudflare R2 -->
    <script src="https://cdn.jsdelivr.net/npm/@aws-sdk/client-s3@3.451.0/dist-browser/client-s3.min.js"></script>

    <script>
        // ============================================================
        // CONFIGURATION (HARDCODED - NOT VISIBLE IN UI)
        // ============================================================
        const CONFIG = {
            IMGBB_API_KEY: 'c72ca3cbb8cd70e6172b8171763679db',
            APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbz2sIsHwOqQPTwTLlsHZgm9D6k9fhH_dZeNxzGYrKfZvTSVfw8Mb0cZg0j8Guefh7MC/exec',
            
            // CLOUDFLARE R2 CREDENTIALS (HIDDEN)
            R2: {
                accountId: '4c21bf1f5a6308dc6bf445b60e24b647',
                endpoint: 'https://4c21bf1f5a6308dc6bf445b60e24b647.r2.cloudflarestorage.com',
                bucket: 'swarnim-videos',
                accessKeyId: '6a76b4d798cdb376fd59600f0fb2fa84',
                secretAccessKey: 'c9f7a7bbdcc1ff0ba27239e2dc7018d217f832404ad1c7192dc2bf3ed41e660d',
                publicDomain: 'https://pub-a8af64134ed74913b3828ee8f389b6c0.r2.dev'
            }
        };

        // Global variables
        let productIdCounter = parseInt(localStorage.getItem('productIdCounter')) || 55;
        let coverImageUrl = '';
        let galleryImageUrls = [];
        let productVideos = [];
        let selectedVideoFile = null;
        let selectedBanner = null;

        // Initialize
        window.addEventListener('load', () => {
            generateProductId();
            loadCategories();
            
            // Video file input listener
            document.getElementById('videoFileInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    selectedVideoFile = file;
                    document.getElementById('uploadVideoBtn').disabled = false;
                    document.getElementById('uploadVideoBtn').textContent = `âž• Upload: ${file.name}`;
                }
            });
            
            // Banner file input listener
            document.getElementById('bannerImage').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    selectedBanner = file;
                    document.getElementById('uploadBannerBtn').disabled = false;
                }
            });
            
            // Upload video button click
            document.getElementById('uploadVideoBtn').addEventListener('click', async function() {
                if (selectedVideoFile) {
                    await uploadVideoToR2(selectedVideoFile);
                }
            });
        });

        // Generate Product ID
        function generateProductId() {
            const id = 'P' + String(productIdCounter).padStart(3, '0');
            document.getElementById('productId').value = id;
            return id;
        }

        // Tab switching
        function switchTab(index) {
            const buttons = document.querySelectorAll('.tab-btn');
            const panels = document.querySelectorAll('.tab-panel');
            
            buttons.forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            
            panels.forEach((panel, i) => {
                panel.classList.toggle('active', i === index);
            });
            
            if (index === 1) loadCategories();
            if (index === 2) loadBanners();
        }

        // ============================================================
        // IMAGE UPLOADS (ImgBB)
        // ============================================================
        
        async function handleCoverImage(input) {
            const file = input.files[0];
            if (!file) return;

            const preview = document.getElementById('coverPreview');
            preview.innerHTML = '<p>Uploading...</p>';

            try {
                const formData = new FormData();
                formData.append('image', file);

                const response = await fetch(`https://api.imgbb.com/1/upload?key=${CONFIG.IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    coverImageUrl = data.data.url;
                    preview.innerHTML = `<img src="${coverImageUrl}" alt="Cover">`;
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                preview.innerHTML = '<p style="color: red;">Upload failed</p>';
                console.error(error);
            }
        }

        async function handleGalleryImages(input) {
            const files = Array.from(input.files);
            if (files.length === 0) return;

            const preview = document.getElementById('galleryPreview');
            preview.innerHTML = '<p>Uploading...</p>';
            galleryImageUrls = [];

            for (const file of files) {
                try {
                    const formData = new FormData();
                    formData.append('image', file);

                    const response = await fetch(`https://api.imgbb.com/1/upload?key=${CONFIG.IMGBB_API_KEY}`, {
                        method: 'POST',
                        body: formData
                    });

                    const data = await response.json();

                    if (data.success) {
                        galleryImageUrls.push(data.data.url);
                    }
                } catch (error) {
                    console.error('Gallery upload error:', error);
                }
            }

            preview.innerHTML = galleryImageUrls.map(url => `<img src="${url}" alt="Gallery">`).join('');
        }

        // ============================================================
        // VIDEO UPLOAD (Cloudflare R2)
        // ============================================================
        
        async function uploadVideoToR2(file) {
            const uploadBtn = document.getElementById('uploadVideoBtn');
            const progress = document.getElementById('videoProgress');
            const progressBar = document.getElementById('videoProgressBar');
            const statusText = document.getElementById('videoUploadStatus');
            
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Uploading to R2...';
            progress.style.display = 'block';
            statusText.style.display = 'block';
            statusText.textContent = 'Uploading video to Cloudflare R2...';
            statusText.style.color = '#666';
            
            try {
                const { S3Client, PutObjectCommand } = window['@aws-sdk/client-s3'];
                
                const s3Client = new S3Client({
                    region: 'auto',
                    endpoint: CONFIG.R2.endpoint,
                    credentials: {
                        accessKeyId: CONFIG.R2.accessKeyId,
                        secretAccessKey: CONFIG.R2.secretAccessKey
                    }
                });

                const timestamp = Date.now();
                const sanitizedName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
                const filename = `videos/${timestamp}_${sanitizedName}`;

                // Simulate progress
                let progressValue = 0;
                const progressInterval = setInterval(() => {
                    if (progressValue < 90) {
                        progressValue += 10;
                        progressBar.style.width = progressValue + '%';
                    }
                }, 200);

                const fileBuffer = await file.arrayBuffer();

                const command = new PutObjectCommand({
                    Bucket: CONFIG.R2.bucket,
                    Key: filename,
                    Body: fileBuffer,
                    ContentType: file.type
                });

                await s3Client.send(command);

                clearInterval(progressInterval);
                progressBar.style.width = '100%';

                const videoUrl = `${CONFIG.R2.publicDomain}/${filename}`;
                const videoSize = (file.size / (1024 * 1024)).toFixed(2) + ' MB';
                
                // Add to video list
                productVideos.push({
                    url: videoUrl,
                    size: videoSize,
                    filename: file.name
                });
                
                renderVideoList();
                
                statusText.textContent = 'âœ… Video uploaded to Cloudflare R2 successfully!';
                statusText.style.color = '#4caf50';
                
                setTimeout(() => {
                    progress.style.display = 'none';
                    statusText.style.display = 'none';
                    progressBar.style.width = '0%';
                    uploadBtn.textContent = 'âž• Upload Video to Cloudflare R2';
                    uploadBtn.disabled = true;
                    selectedVideoFile = null;
                    document.getElementById('videoFileInput').value = '';
                }, 2000);
                
            } catch (error) {
                console.error('R2 upload error:', error);
                statusText.textContent = 'âŒ Upload failed: ' + error.message;
                statusText.style.color = '#dc3545';
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'Retry Upload';
            }
        }

        function renderVideoList() {
            const videoList = document.getElementById('videoList');
            const videoCount = document.getElementById('videoCount');
            
            videoCount.textContent = productVideos.length;
            
            if (productVideos.length === 0) {
                videoList.innerHTML = '';
                return;
            }
            
            videoList.innerHTML = productVideos.map((video, index) => `
                <div class="video-item">
                    <div class="video-thumbnail">
                        <video src="${video.url}" style="width: 100%; height: 100%; object-fit: cover;"></video>
                    </div>
                    <div class="video-info">
                        <div class="video-name">${video.filename}</div>
                        <div class="video-size">${video.size}</div>
                    </div>
                    <div class="video-actions">
                        <button onclick="removeVideo(${index})">ðŸ—‘ï¸ Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function removeVideo(index) {
            productVideos.splice(index, 1);
            renderVideoList();
        }

        // ============================================================
        // PRODUCT SUBMIT
        // ============================================================
        
        document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!coverImageUrl) {
                alert('Please upload a cover image');
                return;
            }

            const productData = {
                action: 'addProduct',
                id: document.getElementById('productId').value,
                name: document.getElementById('productName').value,
                category: document.getElementById('category').value,
                price: document.getElementById('price').value,
                description: document.getElementById('description').value,
                coverImage: coverImageUrl,
                galleryImages: galleryImageUrls.join('|'),
                videoURLs: productVideos.map(v => v.url).join('|')
            };

            try {
                const response = await fetch(CONFIG.APPS_SCRIPT_URL, {
                    method: 'POST',
                    redirect: 'follow',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(productData)
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('status').innerHTML = '<p style="color: green;">âœ… Product saved successfully!</p>';
                    
                    // Increment Product ID
                    productIdCounter++;
                    localStorage.setItem('productIdCounter', productIdCounter);
                    
                    // Reset form
                    document.getElementById('productForm').reset();
                    generateProductId();
                    coverImageUrl = '';
                    galleryImageUrls = [];
                    productVideos = [];
                    document.getElementById('coverPreview').innerHTML = '';
                    document.getElementById('galleryPreview').innerHTML = '';
                    renderVideoList();
                    
                    setTimeout(() => {
                        document.getElementById('status').innerHTML = '';
                    }, 3000);
                } else {
                    document.getElementById('status').innerHTML = '<p style="color: red;">âŒ Failed: ' + data.error + '</p>';
                }
            } catch (error) {
                document.getElementById('status').innerHTML = '<p style="color: red;">âŒ Error: ' + error.message + '</p>';
            }
        });

        // ============================================================
        // CATEGORIES
        // ============================================================
        
        async function loadCategories() {
            try {
                // Use GET to fetch all data (categories come from doGet)
                const response = await fetch(CONFIG.APPS_SCRIPT_URL);
                const data = await response.json();
                const cats = data.categories || [];

                const select = document.getElementById('category');
                const list = document.getElementById('categoryList');

                select.innerHTML = '<option value="">Select a category...</option>';
                list.innerHTML = '';

                cats.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    select.appendChild(option);

                    const item = document.createElement('div');
                    item.className = 'category-item';
                    const safecat = String(cat).replace(/'/g, "\\'");
                    item.innerHTML = `<span>${cat}</span><button onclick="deleteCategory('${safecat}')">ï¿½</button>`;
                    list.appendChild(item);
                });
            } catch (error) {
                console.error('Load categories error:', error);
            }
        }

        async function addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            if (!name) return;

            try {
                const response = await fetch(CONFIG.APPS_SCRIPT_URL, {
                    method: 'POST',
                    redirect: 'follow',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({ action: 'addCategory', category: name })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('newCategoryName').value = '';
                    loadCategories();
                }
            } catch (error) {
                console.error('Add category error:', error);
            }
        }

        async function deleteCategory(name) {
            if (!confirm(`Delete category "${name}"?`)) return;

            try {
                const response = await fetch(CONFIG.APPS_SCRIPT_URL, {
                    method: 'POST',
                    redirect: 'follow',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({ action: 'deleteCategory', category: name })
                });

                const data = await response.json();

                if (data.success) {
                    loadCategories();
                }
            } catch (error) {
                console.error('Delete category error:', error);
            }
        }

        // ============================================================
        // BANNERS
        // ============================================================
        // BANNERS
        // ============================================================
        
        async function uploadBanner() {
            if (!selectedBanner) return;

            const uploadBtn = document.getElementById('uploadBannerBtn');
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Uploading...';

            try {
                const formData = new FormData();
                formData.append('image', selectedBanner);

                const response = await fetch(`https://api.imgbb.com/1/upload?key=${CONFIG.IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });

                const imgData = await response.json();

                if (imgData.success) {
                    const bannerId = 'B' + Date.now().toString(36).toUpperCase();
                    const saveResponse = await fetch(CONFIG.APPS_SCRIPT_URL, {
                        method: 'POST',
                        redirect: 'follow',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify({
                            action: 'addBanner',
                            id: bannerId,
                            imageUrl: imgData.data.url,
                            active: true,
                            sortOrder: 0,
                            title: ''
                        })
                    });

                    const saveData = await saveResponse.json();

                    if (saveData.success) {
                        alert('\u2705 Banner uploaded!');
                        selectedBanner = null;
                        document.getElementById('bannerImage').value = '';
                        uploadBtn.disabled = true;
                        uploadBtn.textContent = 'Upload Banner';
                        loadBanners();
                    }
                }
            } catch (error) {
                alert('\u274c Banner upload failed: ' + error.message);
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'Upload Banner';
            }
        }

        async function loadBanners() {
            try {
                const response = await fetch(CONFIG.APPS_SCRIPT_URL);
                const data = await response.json();
                const banners = (data.banners || []).filter(b => b.active);

                const list = document.getElementById('bannerList');
                list.innerHTML = '';

                banners.forEach(banner => {
                    const item = document.createElement('div');
                    item.className = 'banner-item';
                    item.innerHTML = `
                        <img src="${banner.imageUrl}" alt="${banner.title || 'Banner'}">
                        <div class="banner-info">
                            <strong>${banner.title || 'Banner'}</strong><br>
                            <small>ID: ${banner.id}</small>
                        </div>
                        <button style="background: #dc3545;" onclick="deleteBanner('${banner.id}')">\u{1f5d1} Delete</button>
                    `;
                    list.appendChild(item);
                });
            } catch (error) {
                console.error('Load banners error:', error);
            }
        }

        async function deleteBanner(id) {
            if (!confirm('Delete this banner?')) return;

            try {
                const response = await fetch(CONFIG.APPS_SCRIPT_URL, {
                    method: 'POST',
                    redirect: 'follow',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({ action: 'deleteBanner', id: id })
                });

                const data = await response.json();

                if (data.success) {
                    loadBanners();
                }
            } catch (error) {
                console.error('Delete banner error:', error);
            }
        }
    </script>
</body>
</html>
